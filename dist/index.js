var t,e=(t=require("teme"))&&"object"==typeof t&&"default"in t?t.default:t;const n=function(){function t(){}return t.prototype.then=function(e,n){const o=new t,i=this.s;if(i){const t=1&i?e:n;if(t){try{r(o,1,t(this.v))}catch(t){r(o,2,t)}return o}return this}return this.o=function(t){try{const i=t.v;1&t.s?r(o,1,e?e(i):i):n?r(o,1,n(i)):r(o,2,i)}catch(t){r(o,2,t)}},o},t}();function r(t,e,o){if(!t.s){if(o instanceof n){if(!o.s)return void(o.o=r.bind(null,t,e));1&e&&(e=o.s),o=o.v}if(o&&o.then)return void o.then(r.bind(null,t,e),r.bind(null,t,2));t.s=e,t.v=o;const i=t.o;i&&i(t)}}function o(t){return t instanceof n&&1&t.s}const i={};!function(){function t(t){this._entry=t,this._pact=null,this._resolve=null,this._return=null,this._promise=null}function e(t){return{value:t,done:!0}}function o(t){return{value:t,done:!1}}t.prototype[Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"))]=function(){return this},t.prototype._yield=function(t){return this._resolve(t&&t.then?t.then(o):o(t)),this._pact=new n},t.prototype.next=function(t){const o=this;return o._promise=new Promise(function(u){const s=o._pact;if(null===s){const t=o._entry;if(null===t)return u(o._promise);function a(t){o._resolve(t&&t.then?t.then(e):e(t)),o._pact=null,o._resolve=null}o._entry=null,o._resolve=u,t(o).then(a,function(t){if(t===i)a(o._return);else{const e=new n;o._resolve(e),o._pact=null,o._resolve=null,_resolve(e,2,t)}})}else o._pact=null,o._resolve=u,r(s,1,t)})},t.prototype.return=function(t){const n=this;return n._promise=new Promise(function(o){const u=n._pact;if(null===u)return null===n._entry?o(n._promise):(n._entry=null,o(t&&t.then?t.then(e):e(t)));n._return=t,n._resolve=o,n._pact=null,r(u,2,i)})},t.prototype.throw=function(t){const e=this;return e._promise=new Promise(function(n,o){const i=e._pact;if(null===i)return null===e._entry?n(e._promise):(e._entry=null,o(t));e._resolve=n,e._pact=null,r(i,2,t)})}}();var u=function(t){var n,r=this;void 0===t&&(t={}),this.validator=(n=t.validator||[],Array.isArray(n)?n:[n]),this.parser=t.parser,this.formatter=t.formatter,this.value=e(),this.text=e(),this.value.subscribe(function(t){return r._updateValue(t)}),this.text.subscribe(function(t){return r._updateText(t)}),this.update=e(),this.state=this.update.scan(function(t,e){return Object.assign({},t,e)},{}),this.value(t.value)};u.prototype._updateValue=function(t){var e=a(t,this.formatter);this.update({error:"",value:t,text:e,dirty:!1})},u.prototype._updateText=function(t){var e=this;this.update({text:t,dirty:!0}),Promise.resolve().then(function(){return e.validate()})},u.prototype.validate=function(){try{var t=!1,e=this;function i(){if(u)return e.update({error:u,text:s}),!1;var t=function(t,e){return e?e(t):t}(s,e.parser);return s=a(t,e.formatter),e.update({error:u,value:t,text:s}),!0}var u="",s=e.state().text||"",c=0,l=function(t,e,i){for(var u;;){var s=t();if(o(s)&&(s=s.v),!s)return a;if(s.then){u=0;break}var a=i();if(a&&a.then){if(!o(a)){u=1;break}a=a.s}if(e){var c=e();if(c&&c.then&&!o(c)){u=2;break}}}var l=new n,f=r.bind(null,l,2);return(0===u?s.then(v):1===u?a.then(h):c.then(p)).then(void 0,f),l;function h(n){a=n;do{if(e&&(c=e())&&c.then&&!o(c))return void c.then(p).then(void 0,f);if(!(s=t())||o(s)&&!s.v)return void r(l,1,a);if(s.then)return void s.then(v).then(void 0,f);o(a=i())&&(a=a.v)}while(!a||!a.then);a.then(h).then(void 0,f)}function v(t){t?(a=i())&&a.then?a.then(h).then(void 0,f):h(a):r(l,1,a)}function p(){(s=t())?s.then?s.then(v).then(void 0,f):v(s):r(l,1,a)}}(function(){return!t&&c<e.validator.length},function(){return c++},function(){return Promise.resolve((0,e.validator[c])(s)).then(function(e){(u=e)&&(t=!0)})});return l&&l.then?l.then(i):i()}catch(t){return Promise.reject(t)}};var s=function(t){var n=this;void 0===t&&(t={}),this.fields=t,this.state=e.combine(function(){return n._updateState()},Object.values(t).map(function(t){return t.state})).dedupe(c)};function a(t,e){return e?e(t):null==t?"":String(t)}function c(t,e){return t===e||t&&e&&"object"==typeof t&&"object"==typeof e&&Object.keys(e).every(function(e){return Object.prototype.hasOwnProperty.call(t,e)})&&Object.keys(t).every(function(n){return e[n]===t[n]})}s.prototype._updateState=function(){return Object.values(this.fields).reduce(function(t,e){var n=t.dirty;return{error:t.error||e.state().error,dirty:n||e.state().dirty}},{error:"",dirty:!1})},s.prototype.validate=function(){return Promise.all(Object.values(this.fields).map(function(t){return t.validate()})).then(function(t){return t.every(Boolean)})},s.prototype.set=function(t){Object.entries(this.fields).forEach(function(e){return e[1].value(t[e[0]])})},s.prototype.getChanges=function(){return Object.entries(this.fields).reduce(function(t,e){var n=e[0],r=e[1].state();return r.dirty&&(t[n]=r.value),t},{})},s.prototype.getValues=function(){return Object.entries(this.fields).reduce(function(t,e){return t[e[0]]=e[1].state().value,t},{})},exports.FieldState=u,exports.FormState=s;
//# sourceMappingURL=index.js.map
